# API端点测试报告

**测试时间**: 2025-12-18 09:17:39

**总测试数**: 21

**成功**: 16

**失败**: 5

---

## Cognee API

### Cognee Health Check ✅ 成功

**描述**: Cognee服务健康检查

**方法**: GET

**URL**: `http://192.168.66.11:8000/health`

**HTTP状态码**: 200

**响应**:

```json
{
  "status": "ready",
  "health": "healthy",
  "version": "0.4.1-local"
}
```

---

### Cognee Search Knowledge ✅ 成功

**描述**: 从Cognee知识库搜索知识（数据集: kb_tech）

**方法**: POST

**URL**: `http://192.168.66.11:8000/api/v1/search`

**请求数据**:

```json
{
  "query": "Python编程基础",
  "datasets": [
    "kb_tech"
  ],
  "search_type": "GRAPH_COMPLETION",
  "top_k": 5
}
```

**HTTP状态码**: 200

**响应**:

```json
['Python编程基础包括以下几个主要内容：\n\n1. **变量与数据类型**：Python支持多种数据类型，包括整数（int）、浮点数（float）、字符串（str）、布尔值（bool）。\n2. **运算符**：包括算术运算符、比较运算符和逻辑运算符。\n3. **控制流语句**：使用if-elif-else进行条件判断，for和while循环进行循环操作。\n4. **输入输出**：使用print()函数进行输出，input()函数获取用户输入。\n5. **错误处理**：通过try-except语句处理异常，使用raise抛出自定义异常。\n6. **上下文管理**：使用with语句确保资源的正确管理。\n7. **日志记录**：使用logging模块进行调试和记录错误信息。\n\nPython强调代码的可读性与简洁性，是一种广泛使用的编程语言。']
```

---

### Cognee List Datasets ✅ 成功

**描述**: 列出Cognee中的所有数据集

**方法**: GET

**URL**: `http://192.168.66.11:8000/api/v1/datasets`

**HTTP状态码**: 200

**响应**:

```json
[{'id': '146d0e95-f93c-541f-abdb-9ac76f14fb9f', 'name': 'kb_psyc', 'createdAt': '2025-12-18T01:08:30.326445Z', 'updatedAt': None, 'ownerId': '73ab78eb-b9cf-471f-9f87-dce6b6b95b9e'}, {'id': '432ee6e2-454b-53ab-9974-3bd4c5f9831b', 'name': 'kb_tech', 'createdAt': '2025-12-17T09:10:15.572827Z', 'updatedAt': None, 'ownerId': '73ab78eb-b9cf-471f-9f87-dce6b6b95b9e'}]
```

---

## Memobase API

### Memobase Health Check ✅ 成功

**描述**: Memobase服务健康检查

**方法**: GET

**URL**: `http://192.168.66.11:8019/api/v1/healthcheck`

**HTTP状态码**: 200

**响应**:

```json
{
  "data": null,
  "errno": 0,
  "errmsg": ""
}
```

---

### Memobase Get User (Before Create) ✅ 成功

**描述**: 获取用户信息（UUID: 5e7e5f3b-6416-567a-80cb-4ee21a6a03ec，可能不存在）

**方法**: GET

**URL**: `http://192.168.66.11:8019/api/v1/users/5e7e5f3b-6416-567a-80cb-4ee21a6a03ec`

**HTTP状态码**: 200

**响应**:

```json
{
  "data": {
    "data": {},
    "id": null,
    "created_at": "2025-12-18T01:14:42.240013Z",
    "updated_at": "2025-12-18T01:14:42.240013Z"
  },
  "errno": 0,
  "errmsg": ""
}
```

---

### Memobase Create User ✅ 成功

**描述**: 创建新用户（UUID: 5e7e5f3b-6416-567a-80cb-4ee21a6a03ec）

**方法**: POST

**URL**: `http://192.168.66.11:8019/api/v1/users`

**请求数据**:

```json
{
  "id": "5e7e5f3b-6416-567a-80cb-4ee21a6a03ec",
  "data": {}
}
```

**HTTP状态码**: 200

**响应**:

```json
{
  "data": null,
  "errno": 500,
  "errmsg": "Sorry, we have encountered an unknown error: \n(psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint \"users_pkey\"\nDETAIL:  Key (id, project_id)=(5e7e5f3b-6416-567a-80cb-4ee21a6a03ec, __root__) already exists.\n\n[SQL: INSERT INTO users (additional_fields, project_id, id) VALUES (%(additional_fields)s::JSONB, %(project_id)s, %(id)s::UUID) RETURNING users.created_at, users.updated_at]\n[parameters: {'additional_fields': '{}', 'project_id': '__root__', 'id': '5e7e5f3b-6416-567a-80cb-4ee21a6a03ec'}]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)\nPlease report this issue to https://github.com/memodb-io/memobase/issues"
}
```

---

### Memobase Get User (After Create) ✅ 成功

**描述**: 获取用户信息（验证创建是否成功）

**方法**: GET

**URL**: `http://192.168.66.11:8019/api/v1/users/5e7e5f3b-6416-567a-80cb-4ee21a6a03ec`

**HTTP状态码**: 200

**响应**:

```json
{
  "data": {
    "data": {},
    "id": null,
    "created_at": "2025-12-18T01:14:42.240013Z",
    "updated_at": "2025-12-18T01:14:42.240013Z"
  },
  "errno": 0,
  "errmsg": ""
}
```

---

### Memobase Get User (Final) ✅ 成功

**描述**: 获取用户信息（最终状态）

**方法**: GET

**URL**: `http://192.168.66.11:8019/api/v1/users/5e7e5f3b-6416-567a-80cb-4ee21a6a03ec`

**HTTP状态码**: 200

**响应**:

```json
{
  "data": {
    "data": {},
    "id": null,
    "created_at": "2025-12-18T01:14:42.240013Z",
    "updated_at": "2025-12-18T01:14:42.240013Z"
  },
  "errno": 0,
  "errmsg": ""
}
```

---

## Mem0 API

### Mem0 Health Check ❌ 失败

**描述**: Mem0服务健康检查

**方法**: GET

**URL**: `http://192.168.66.11:8888/health`

**HTTP状态码**: 404

**错误**: HTTP 404

**响应**:

```json
{
  "detail": "Not Found"
}
```

---

### Mem0 Search Memories (Current Session) ✅ 成功

**描述**: 搜索当前会话的记忆

**方法**: POST

**URL**: `http://192.168.66.11:8888/api/v1/search`

**请求数据**:

```json
{
  "query": "用户信息",
  "user_id": "test_user_001",
  "agent_id": "test_session_001"
}
```

**HTTP状态码**: 200

**响应**:

```json
{
  "results": [
    {
      "id": "a71d7eb5-7d37-46e1-89a5-55a73ad51785",
      "memory": "Name is 测试用户",
      "hash": "e822a25bcd9e5e75a6f1486a01b91450",
      "metadata": {
        "dataset_names": [
          "kb_tech"
        ],
        "timestamp": "2025-12-17T17:41:46.214234"
      },
      "score": 0.45364118,
      "created_at": "2025-12-17T01:41:55.170029-08:00",
      "updated_at": null,
      "user_id": "test_user_001",
      "agent_id": "test_session_001"
    },
    {
      "id": "6603e51b-58e2-4492-b95f-82833f3c890a",
      "memory": "Is a 软件工程师",
      "hash": "356e29e127d35bc285b93f7c2bd4c8a5",
      "metadata": {
        "dataset_names": [
          "kb_tech"
        ],
        "timestamp": "2025-12-18T09:15:28.935704"
      },
      "score": 0.24696708,
      "created_at": "2025-12-17T01:41:55.203478-08:00",
      "updated_at": "2025-12-17T17:15:32.892892-08:00",
      "user_id": "test_user_001",
      "agent_id": "test_session_001"
    },
    {
      "id": "a8f019a6-6ce0-4943-b04f-202efbaebe68",
      "memory": "喜欢Python编程",
      "hash": "96ca3252066b2dd050fc5212e1e7827c",
      "metadata": {
        "dataset_names": [
          "kb_tech"
        ],
        "timestamp": "2025-12-18T09:15:10.033786"
      },
      "score": 0.18261509,
      "created_at": "2025-12-17T17:15:18.824442-08:00",
      "updated_at": null,
      "user_id": "test_user_001",
      "agent_id": "test_session_001"
    },
    {
      "id": "1d941335-7eff-463d-9129-738b52d8f01c",
      "memory": "喜欢Python编程",
      "hash": "96ca3252066b2dd050fc5212e1e7827c",
      "metadata": {
        "dataset_names": [
          "kb_tech"
        ],
        "timestamp": "2025-12-17T18:04:52.820769"
      },
      "score": 0.18260665,
      "created_at": "2025-12-17T01:41:27.890583-08:00",
      "updated_at": "2025-12-17T02:04:58.306044-08:00",
      "user_id": "test_user_001",
      "agent_id": "test_session_001"
    }
  ]
}
```

---

### Mem0 Search Memories (Cross Session) ✅ 成功

**描述**: 搜索跨会话的记忆

**方法**: POST

**URL**: `http://192.168.66.11:8888/api/v1/search`

**请求数据**:

```json
{
  "query": "用户信息",
  "user_id": "test_user_001"
}
```

**HTTP状态码**: 200

**响应**:

```json
{
  "results": [
    {
      "id": "07479764-f267-438e-a192-0d2f80de2e61",
      "memory": "Name is 测试用户",
      "hash": "e822a25bcd9e5e75a6f1486a01b91450",
      "metadata": null,
      "score": 0.45364118,
      "created_at": "2025-12-17T01:24:46.711307-08:00",
      "updated_at": null,
      "user_id": "test_user_001"
    },
    {
      "id": "a71d7eb5-7d37-46e1-89a5-55a73ad51785",
      "memory": "Name is 测试用户",
      "hash": "e822a25bcd9e5e75a6f1486a01b91450",
      "metadata": {
        "dataset_names": [
          "kb_tech"
        ],
        "timestamp": "2025-12-17T17:41:46.214234"
      },
      "score": 0.45364118,
      "created_at": "2025-12-17T01:41:55.170029-08:00",
      "updated_at": null,
      "user_id": "test_user_001",
      "agent_id": "test_session_001"
    },
    {
      "id": "6603e51b-58e2-4492-b95f-82833f3c890a",
      "memory": "Is a 软件工程师",
      "hash": "356e29e127d35bc285b93f7c2bd4c8a5",
      "metadata": {
        "dataset_names": [
          "kb_tech"
        ],
        "timestamp": "2025-12-18T09:15:28.935704"
      },
      "score": 0.24696708,
      "created_at": "2025-12-17T01:41:55.203478-08:00",
      "updated_at": "2025-12-17T17:15:32.892892-08:00",
      "user_id": "test_user_001",
      "agent_id": "test_session_001"
    },
    {
      "id": "a8f019a6-6ce0-4943-b04f-202efbaebe68",
      "memory": "喜欢Python编程",
      "hash": "96ca3252066b2dd050fc5212e1e7827c",
      "metadata": {
        "dataset_names": [
          "kb_tech"
        ],
        "timestamp": "2025-12-18T09:15:10.033786"
      },
      "score": 0.18261509,
      "created_at": "2025-12-17T17:15:18.824442-08:00",
      "updated_at": null,
      "user_id": "test_user_001",
      "agent_id": "test_session_001"
    },
    {
      "id": "1d941335-7eff-463d-9129-738b52d8f01c",
      "memory": "喜欢Python编程",
      "hash": "96ca3252066b2dd050fc5212e1e7827c",
      "metadata": {
        "dataset_names": [
          "kb_tech"
        ],
        "timestamp": "2025-12-17T18:04:52.820769"
      },
      "score": 0.18260665,
      "created_at": "2025-12-17T01:41:27.890583-08:00",
      "updated_at": "2025-12-17T02:04:58.306044-08:00",
      "user_id": "test_user_001",
      "agent_id": "test_session_001"
    },
    {
      "id": "68260f30-571e-4ca9-90eb-97cf685fddad",
      "memory": "Is a software engineer",
      "hash": "8db92c7668b54156c2f9cd2f7e318032",
      "metadata": {
        "dataset_names": [
          "kb_tech"
        ],
        "timestamp": "2025-12-17T18:05:21.049498"
      },
      "score": 0.15171652,
      "created_at": "2025-12-17T02:05:25.263662-08:00",
      "updated_at": null,
      "user_id": "test_user_001",
      "agent_id": "test_session_002"
    }
  ]
}
```

---

### Mem0 Create Memory ✅ 成功

**描述**: 创建新的记忆

**方法**: POST

**URL**: `http://192.168.66.11:8888/api/v1/memories`

**请求数据**:

```json
{
  "messages": [
    {
      "role": "user",
      "content": "我是测试用户，喜欢Python编程"
    },
    {
      "role": "assistant",
      "content": "好的，我记住了"
    }
  ],
  "user_id": "test_user_001",
  "agent_id": "test_session_001"
}
```

**HTTP状态码**: 200

**响应**:

```json
{
  "results": []
}
```

---

### Mem0 Search Memories (After Create) ✅ 成功

**描述**: 创建记忆后再次搜索，验证记忆是否保存成功

**方法**: POST

**URL**: `http://192.168.66.11:8888/api/v1/search`

**请求数据**:

```json
{
  "query": "Python编程",
  "user_id": "test_user_001",
  "agent_id": "test_session_001"
}
```

**HTTP状态码**: 200

**响应**:

```json
{
  "results": [
    {
      "id": "1d941335-7eff-463d-9129-738b52d8f01c",
      "memory": "喜欢Python编程",
      "hash": "96ca3252066b2dd050fc5212e1e7827c",
      "metadata": {
        "dataset_names": [
          "kb_tech"
        ],
        "timestamp": "2025-12-17T18:04:52.820769"
      },
      "score": 0.6552806,
      "created_at": "2025-12-17T01:41:27.890583-08:00",
      "updated_at": "2025-12-17T02:04:58.306044-08:00",
      "user_id": "test_user_001",
      "agent_id": "test_session_001"
    },
    {
      "id": "a8f019a6-6ce0-4943-b04f-202efbaebe68",
      "memory": "喜欢Python编程",
      "hash": "96ca3252066b2dd050fc5212e1e7827c",
      "metadata": {
        "dataset_names": [
          "kb_tech"
        ],
        "timestamp": "2025-12-18T09:15:10.033786"
      },
      "score": 0.6552235,
      "created_at": "2025-12-17T17:15:18.824442-08:00",
      "updated_at": null,
      "user_id": "test_user_001",
      "agent_id": "test_session_001"
    },
    {
      "id": "6603e51b-58e2-4492-b95f-82833f3c890a",
      "memory": "Is a 软件工程师",
      "hash": "356e29e127d35bc285b93f7c2bd4c8a5",
      "metadata": {
        "dataset_names": [
          "kb_tech"
        ],
        "timestamp": "2025-12-18T09:15:28.935704"
      },
      "score": 0.25044835,
      "created_at": "2025-12-17T01:41:55.203478-08:00",
      "updated_at": "2025-12-17T17:15:32.892892-08:00",
      "user_id": "test_user_001",
      "agent_id": "test_session_001"
    },
    {
      "id": "a71d7eb5-7d37-46e1-89a5-55a73ad51785",
      "memory": "Name is 测试用户",
      "hash": "e822a25bcd9e5e75a6f1486a01b91450",
      "metadata": {
        "dataset_names": [
          "kb_tech"
        ],
        "timestamp": "2025-12-17T17:41:46.214234"
      },
      "score": 0.22845256,
      "created_at": "2025-12-17T01:41:55.170029-08:00",
      "updated_at": null,
      "user_id": "test_user_001",
      "agent_id": "test_session_001"
    }
  ]
}
```

---

## POC API

### POC Root ✅ 成功

**描述**: POC项目根路径

**方法**: GET

**URL**: `http://localhost:8080/`

**HTTP状态码**: 200

**响应**:

```json
{
  "name": "Conversational Agent POC",
  "version": "0.1.0",
  "status": "running"
}
```

---

### POC Health Check ✅ 成功

**描述**: POC服务健康检查

**方法**: GET

**URL**: `http://localhost:8080/health`

**HTTP状态码**: 200

**响应**:

```json
{
  "status": "healthy"
}
```

---

### POC Debug Status ✅ 成功

**描述**: 查看POC服务状态和配置

**方法**: GET

**URL**: `http://localhost:8080/api/v1/debug/status`

**HTTP状态码**: 200

**响应**:

```json
{
  "success": true,
  "services": {
    "cognee": {
      "url": "http://192.168.66.11:8000",
      "initialized": true
    },
    "memobase": {
      "url": "http://192.168.66.11:8019",
      "initialized": true
    },
    "mem0": {
      "url": "http://192.168.66.11:8888",
      "initialized": true
    },
    "openai": {
      "model": "gpt-4",
      "base_url": "https://oneapi.naivehero.top/v1"
    }
  }
}
```

---

### POC First Conversation ❌ 失败

**描述**: 第一次对话，创建用户画像和记忆

**方法**: POST

**URL**: `http://localhost:8080/api/v1/test/conversation`

**请求数据**:

```json
{
  "user_id": "test_user_001",
  "session_id": "test_session_001",
  "message": "你好，我是测试用户，我是一名软件工程师，对Python很感兴趣",
  "dataset_names": [
    "kb_tech"
  ]
}
```

**HTTP状态码**: 500

**错误**: HTTP 500

**响应**:

```json
{
  "detail": "Object of type UserProfile is not JSON serializable"
}
```

---

### POC Get User Profile ❌ 失败

**描述**: 获取用户画像

**方法**: GET

**URL**: `http://localhost:8080/api/v1/users/test_user_001/profile`

**HTTP状态码**: 500

**错误**: HTTP 500

**响应**:

```json
{
  "detail": "Object of type UserProfile is not JSON serializable"
}
```

---

### POC Second Conversation (Memory Test) ❌ 失败

**描述**: 第二次对话，测试记忆功能

**方法**: POST

**URL**: `http://localhost:8080/api/v1/test/conversation`

**请求数据**:

```json
{
  "user_id": "test_user_001",
  "session_id": "test_session_001",
  "message": "我之前说过我的职业是什么？",
  "dataset_names": [
    "kb_tech"
  ]
}
```

**HTTP状态码**: 500

**错误**: HTTP 500

**响应**:

```json
{
  "detail": "Object of type UserProfile is not JSON serializable"
}
```

---

### POC New Session (Cross-Session Memory) ❌ 失败

**描述**: 新会话，测试跨会话记忆

**方法**: POST

**URL**: `http://localhost:8080/api/v1/test/conversation`

**请求数据**:

```json
{
  "user_id": "test_user_001",
  "session_id": "test_session_002",
  "message": "你还记得我的职业吗？",
  "dataset_names": [
    "kb_tech"
  ]
}
```

**HTTP状态码**: 500

**错误**: HTTP 500

**响应**:

```json
{
  "detail": "Object of type UserProfile is not JSON serializable"
}
```

---

### POC Send Message (Standard API) ✅ 成功

**描述**: 发送消息并获取响应（标准接口）

**方法**: POST

**URL**: `http://localhost:8080/api/v1/conversations/test_session_001/messages`

**请求数据**:

```json
{
  "message": "Python有哪些常用的数据结构？",
  "user_id": "test_user_001",
  "session_id": "test_session_001",
  "dataset_names": [
    "kb_tech"
  ]
}
```

**HTTP状态码**: 200

**响应**:

```json
{
  "success": true,
  "session_id": "test_session_001",
  "response": "Python 常用的数据结构包括：\n\n1. **列表 (List)**：有序、可变的元素集合。\n2. **元组 (Tuple)**：有序、不可变的元素集合。\n3. **字典 (Dict)**：键值对的集合，键唯一且不可变。\n4. **集合 (Set)**：无序、不重复元素的集合。\n\n此外，还有 **defaultdict**、**namedtuple** 和 **frozenset** 等特定类型的数据结构。",
  "timestamp": "2024-01-01T00:00:00Z"
}
```

---

